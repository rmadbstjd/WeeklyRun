


# WeeklyRun
![sport centre (1)](https://user-images.githubusercontent.com/108918319/193982219-1d35c2b1-5de5-413a-9dcc-1fcc3d9f7675.png)
<h2><a href="https://weeklyrun.com">Home Page</a> / <a href="https://www.youtube.com/watch?v=wmHWVBSeeHE">Youtube</a></h2>
<br/>

🏃‍ 런닝을 하고 싶은데 동기부여가 있으면 좋겠나요?<br/>
⏰ 한 주간의 목표를 세우고 매일매일 기록을 확인하며<br/>
🥇 주간 랭킹 시스템을 통해 선의의 경쟁을 하<br/>
👪 유저들과 피드를 공유해보세요!

# 주요기능
### 1. 로그인
* 접근성을 높이기 위해 네이버 와 카카오를 활용한 소셜로그인으로 간편하게 로그인 가능합니다.
### 2. 목표 설정하기
* 한 주간의 목표를 설정하고, 하루하루의 기록을 볼 수 있으며 , 일주일 마다 월요일 기준으로 목표를 초기화합니다.  
### 3. 런닝 기록하기
* 실시간 위치를 기반으로 런닝을 추적하며 기록 및 피드를 통해 공유할 수 있습니다.
### 4. 피드
* 최신순 및 좋아요 순으로 정렬하여 볼 수 있습니다.
* 좋아요 및 댓글, 대댓글을 이용할 수 있습니다.
### 5. 검색하기
* 해시태그 및 유저 이름을 추천 검색어 및 자동완성 기능을 이용하여 검색하고 해당 유저의 피드 페이지를 확인 할 수 있습니다.
### 6. 댓글페이지
* 댓글을 입력 할 수 있으며, 슬라이드를 이용하여 수정 및 삭제 가 가능합니다.
### 7. 주간 랭킹 기능
일주일간 달린 거리를 기준으로 상위 5명의 프로필, 달린 거리, 시간 등을 볼 수 있으며, 나의 랭킹 순위도 확인할 수 있습니다.
### 8. 신고하기 기능
* 부적절한 게시글 을 신고 하거나, 이용중에 발생한 문제에 관해 신고할 수 있는 별도의 페이지가 존재합니다.

<h2>🗓 프로젝트 기간 </h2>
2022년 08월 26일 ~ 2022년 10월 7일
<br/>
<br/>
<h2>🛠 기술스택 </h2>
<div align="center">
  <img src="https://img.shields.io/badge/Nodejs-E34F26?style=for-the-badge&logo=Nodejs&logoColor=white"> 
  <img src="https://img.shields.io/badge/express-1572B6?style=for-the-badge&logo=express3&logoColor=white"> 
  <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black"> 
  <img src="https://img.shields.io/badge/sequelize-61DAFB?style=for-the-badge&logo=sequelize&logoColor=black"> 
  <br/>
  <img src="https://img.shields.io/badge/Mysql-FF4154?style=for-the-badge&logo=Mysql&logoColor=black"> 
  <img src="https://img.shields.io/badge/jwt-61DAFB?style=for-the-badge&logo=jwt&logoColor=black"> 
  <img src="https://img.shields.io/badge/pm2-DB7093?style=for-the-badge&logo=pm2&logoColor=white"> 
  
   <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white"> 
   <img src="https://img.shields.io/badge/Jenkins-181717?style=for-the-badge&logo=Jenkins&logoColor=white"> 
</div>

<h2>📖 라이브러리 </h2>
<table border = 1>
  <tr>
    <th>라이브러리</th>
    <th>설명</th>
  </tr>
  <tr>
    <th>dotenv</th>
    <th>환경 변수 관리</th>
  </tr>
  <tr>
    <th>cors</th>
    <th>교차 리소스 공유</th>
  </tr>
  <tr>
    <th>express</th>
    <th>서버</th>
  </tr>
  <tr>
    <th>cors</th>
    <th>교차 리소스 공유</th>
  </tr>
  <tr>
    <th>jsonwebtoken</th>
    <th>서명 암호화</th>
  </tr>
  <tr>
    <th>winston</th>
    <th>로그 관리</th>
  </tr>
  <tr>
    <th>node-mailer</th>
    <th>웰컴 메일 및 에러 발생시에 관리자 계정으로 메일 발송</th>
  </tr>
  <tr>
    <th>node-scheduler</th>
    <th>일정 주기마다 로직 실행</th>
  </tr>
  <tr>
    <th>mysql2</th>
    <th>async/await 사용 위해 설치</th>
  </tr>
  <tr>
    <th>sequelize</th>
    <th>My SQL ORM</th>
  </tr>
  <tr>
    <th>prettier</th>
    <th>코드 스타일 통일</th>
  </tr>
  <tr>
    <th>helemt</th>
    <th>보안 강화</th>
  </tr>
  <tr>
    <th>multer-S3</th>
    <th>S3에 이미지 저장</th>
  </tr>
  <tr>
    <th>passport</th>
    <th>소셜 로그인 미들웨어</th>
  </tr>
</table>


# 📚 아키텍처 
![image02](https://user-images.githubusercontent.com/108918319/193979846-1da1a6da-c710-4cd4-ad75-5238cc8c3066.png)

# 🗃 ERD
![image](https://user-images.githubusercontent.com/58474431/193502539-51cb4273-d864-4c35-82f5-0cf6aaeefaaf.png)



<h1>📋 <a href="https://www.notion.so/Weekly-Run-API-c5ba2f0594b248c99e0063f6bf33ceda">API 명세서<a></h1>

# 트러블 슈팅

### 문제 상황
 댓글을 작성한 유저가 회원 탈퇴시 댓글은 사라지지만 게시글의 존재하는 댓글 수가 유저가 작성한 댓글 수만큼 줄어들지 않는 문제가 발생함. 
  
### 해결 방안
 1. 탈퇴하려는 유저가 작성한 모든 댓글을 가져옴.
 2. 가져온 댓글의 수만큼 반복문을 돌려 유저가 작성한 댓글의 Column인 postId를 where문을 사용하여 댓글이 달린 게시글을 모두 가져옴.
 3. 게시글들의 id를 배열에 저장하고, 유저가 하나의 게시글에 여러 개의 댓글을 달았을 경우를 고려하여 Set()을 사용하여 id가 중복되지 않도록 함.
 4. where문을 통해 배열안에 저장된 postId가 같은 게시글들을 가져온 후, 가져온 게시글들의 postId가 배열의 postId와 같으면 count를 1씩 증가함.
 
 5. 게시글의 Column인 commentNum에서 count만큼 빼준 후 update문을 통해 게시글을 업데이트함.
 ![image](https://user-images.githubusercontent.com/58474431/194772983-178a44ae-e39e-45df-bd3a-895c177158d5.png)
 
### 효과
 유저가 탈퇴할 경우, 기존에 일치하지 않던 게시글의 댓글 수가 일치하여 정확한 댓글 수를 사용자에게 제공되도록 함.    
 



### 문제 상황
 유저가 검색창에 해쉬태그를 입력할 때 해쉬태그를 끝까지 작성해야만 해쉬태그가 보이는 것은 편의성을 낮춘다고 판단함.
 따라서 해쉬태그를 끝까지 작성하지 않더라도 자동완성 기능을 통해 편의성을 높이도록 함

### 해결 방안
 1. 해쉬태그를 저장할 때 hashtags 테이블에 consonant라는 컬럼을 만들어 자음,모음으로 분리하여 저장 ex) 런닝 =>ㄹㅓㄴㄴㅣㅇ
 2. 유저가 해쉬태그를 검색창에 입력하면 korean-exrep 패키지를 사용하여 자음과 모음으로 분리함 ex) '런'을 입력하면 'ㄹㅓㄴ'으로 분리
 3. Sequelize의 OP.like 속성을 이용하여 where문을 통해 조건에 맞는 데이터를 가져온 후 리턴한다. ex) 'ㄹ'을 입력시 컬럼 consonant가 'ㄹㅓㄴ'인 데이터를 리턴
 
 ### 코드
 
![image](https://user-images.githubusercontent.com/58474431/194777149-8c16c193-e9a1-4de0-8fa8-1eec88f40d27.png)

 ### 효과
 기존에는 검색창에 해쉬태그 '새벽런닝'을 전부 입력하였다면 개선 후에는 'ㅅ' 혹은 '새'만 쳐도 '새벽런닝'이 완성된 것을 볼 수 있음.  
 ### Before
 
 ![33](https://user-images.githubusercontent.com/58474431/194777746-669fa784-9854-4f88-9f45-5702c31f4d30.jpg)

 
 ### After
 
![11](https://user-images.githubusercontent.com/58474431/194777048-298700c2-d7e0-4dc0-91dd-6b44c507e399.jpg)
![22](https://user-images.githubusercontent.com/58474431/194777058-5d0a57a6-f851-4f1c-97f5-06094b164da2.jpg)

 
# 프로젝트에 기여한 나의 역할
 ### 게시글
- 게시글 CRUD, 최신 및 인기 순으로 게시글 정렬, 해쉬태그를 통한 게시글 검색, 좋아요 누르기, 신고하기 기능 
### 유저
- 회원가입 및 회원탈퇴, 회원가입시 웰컴 메일, 프로필 및 닉네임 변경
### 기
- 주간 목표 설정 및 수정, 실시간 이동한 거리 반환, 매일 달린 거리 및 시간 저장, 주간 랭킹 시스템
### 배포
- AWS EC2에 서버 배포및 S3에 이미지 업로드 
      






# 팀원
|팀원 |깃허브 주소| 역할|
|-----|-----|------|
| |
|신성규 |  https://github.com/sinsk23  | 댓글, 대댓글, 로깅(winston, morgon), CICD : Jenkins|
|김대석 |  https://github.com/SkyWind4225   | 카카오로그인, 네이버로그인 |

프론트엔드 Github : https://github.com/HangHae99-Class8-FinalProject/WeeklyRun-FE

