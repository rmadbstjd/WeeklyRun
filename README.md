


# WeeklyRun
![sport centre (1)](https://user-images.githubusercontent.com/108918319/193982219-1d35c2b1-5de5-413a-9dcc-1fcc3d9f7675.png)
<h2><a href="https://weeklyrun.com">Home Page</a> / <a href="https://www.youtube.com/watch?v=wmHWVBSeeHE">Youtube</a></h2>
<br/>

🏃‍ 런닝을 하고 싶은데 동기부여가 있으면 좋겠나요?<br/>
⏰ 한 주간의 목표를 세우고 매일매일 기록을 확인하며<br/>
🥇 주간 랭킹 시스템을 통해 선의의 경쟁을 하고<br/>
👪 유저들과 피드를 공유해보세요!

# 주요기능
### 1. 로그인
* 접근성을 높이기 위해 네이버 와 카카오를 활용한 소셜로그인으로 간편하게 로그인 가능합니다.
### 2. 목표 설정하기
* 한 주간의 목표를 설정하고, 하루하루의 기록을 볼 수 있으며 , 일주일 마다 월요일 기준으로 목표를 초기화합니다.  
### 3. 런닝 기록하기
* 실시간 위치를 기반으로 런닝을 추적하며 기록 및 피드를 통해 공유할 수 있습니다.
### 4. 피드
* 최신순 및 좋아요 순으로 정렬하여 볼 수 있습니다.
* 좋아요 및 댓글, 대댓글을 이용할 수 있습니다.
### 5. 검색하기
* 해시태그 및 유저 이름을 추천 검색어 및 자동완성 기능을 이용하여 검색하고 해당 유저의 피드 페이지를 확인 할 수 있습니다.
### 6. 댓글페이지
* 댓글을 입력 할 수 있으며, 슬라이드를 이용하여 수정 및 삭제 가 가능합니다.
### 7. 주간 랭킹 기능
일주일간 달린 거리를 기준으로 상위 5명의 프로필, 달린 거리, 시간 등을 볼 수 있으며, 나의 랭킹 순위도 확인할 수 있습니다.
### 8. 신고하기 기능
* 부적절한 게시글 을 신고 하거나, 이용중에 발생한 문제에 관해 신고할 수 있는 별도의 페이지가 존재합니다.

<h2>🗓 프로젝트 기간 </h2>
2022년 08월 26일 ~ 2022년 10월 7일
<br/>
<br/>
<h2>🛠 기술스택 </h2>
<div align="center">
  <img src="https://img.shields.io/badge/Nodejs-E34F26?style=for-the-badge&logo=Nodejs&logoColor=white"> 
  <img src="https://img.shields.io/badge/express-1572B6?style=for-the-badge&logo=express3&logoColor=white"> 
  <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black"> 
  <img src="https://img.shields.io/badge/sequelize-61DAFB?style=for-the-badge&logo=sequelize&logoColor=black"> 
  <br/>
  <img src="https://img.shields.io/badge/Mysql-FF4154?style=for-the-badge&logo=Mysql&logoColor=black"> 
  <img src="https://img.shields.io/badge/jwt-61DAFB?style=for-the-badge&logo=jwt&logoColor=black"> 
  <img src="https://img.shields.io/badge/pm2-DB7093?style=for-the-badge&logo=pm2&logoColor=white"> 
  
   <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white"> 
   <img src="https://img.shields.io/badge/Jenkins-181717?style=for-the-badge&logo=Jenkins&logoColor=white"> 
</div>

<h2>📖 라이브러리 </h2>
<table border = 1>
  <tr>
    <th>라이브러리</th>
    <th>설명</th>
  </tr>
  <tr>
    <th>dotenv</th>
    <th>환경 변수 관리</th>
  </tr>
  <tr>
    <th>express</th>
    <th>서버</th>
  </tr>
  <tr>
    <th>cors</th>
    <th>교차 리소스 공유</th>
  </tr>
  <tr>
    <th>jsonwebtoken</th>
    <th>서명 암호화</th>
  </tr>
  <tr>
    <th>winston</th>
    <th>로그 관리</th>
  </tr>
  <tr>
    <th>node-mailer</th>
    <th>웰컴 메일 및 에러 발생시에 관리자 계정으로 메일 발송</th>
  </tr>
  <tr>
    <th>node-scheduler</th>
    <th>일정 주기마다 로직 실행</th>
  </tr>
  <tr>
    <th>mysql2</th>
    <th>async/await 사용 위해 설치</th>
  </tr>
  <tr>
    <th>sequelize</th>
    <th>My SQL ORM</th>
  </tr>
  <tr>
    <th>prettier</th>
    <th>코드 스타일 통일</th>
  </tr>
  <tr>
    <th>helemt</th>
    <th>보안 강화</th>
  </tr>
  <tr>
    <th>multer-S3</th>
    <th>S3에 이미지 저장</th>
  </tr>
  <tr>
    <th>passport</th>
    <th>소셜 로그인 미들웨어</th>
  </tr>
</table>


# 📚 아키텍처 
![image02](https://user-images.githubusercontent.com/108918319/193979846-1da1a6da-c710-4cd4-ad75-5238cc8c3066.png)

# 🗃 ERD
![image](https://user-images.githubusercontent.com/58474431/194806578-02ca04da-82f7-4145-bfb3-0c21b5341c04.png)


# 트러블 슈팅

### 문제 인지
 댓글을 작성한 유저가 회원 탈퇴시 댓글은 사라지지만 게시글의 존재하는 댓글 수가 유저가 작성한 댓글 수만큼 줄어들지 않는 문제가 발생함. 
  
### 해결 방안
1. 탈퇴한 유저가 작성한 모든 댓글을 가져온다.
2. 각 댓글이 갖고 있는 Foreign key인 게시글 id를 통해 유저가 댓글을 작성한 게시글을 모두 가져온다.
3. 게시글의 id를 배열에 저장하고, 유저가 하나의 게시글에 여러 댓글을 작성했다면 배열에 중복된 id가 있으므로, Set() 함수를 통해 중복된 id를 제거한다.
4. 배열의 반복문을 통해 유저가 작성한 댓글의 수를 카운트하고, 해당 게시글의 총 댓글 수에서 카운트 만큼 뺀 후, 게시글을 다시 업데이트한다.

### 코드
![image](https://github.com/rmadbstjd/WeeklyRun/assets/58474431/8d34bc1b-07af-44a3-9dfb-b66a35af831b)

### 효과
 유저가 탈퇴할 경우, 기존에 일치하지 않던 게시글의 댓글 수가 일치하여 정확한 댓글 수를 사용자에게 제공되도록 함.    
 <br/>

### 문제 상황
  교통 수단을 타고 기록을 측정할 경우, 공정한 경쟁이 방해받는 문제 발생
  
### 문제 인지
  초기 유저를 확보하기 위해 주간 랭킹 시스템에서 순위권에 있는 사람들에게 상품을 주는 이벤
    트를 열었는데 비상식적인 속도로 기록을 쌓는 유저가 있었다. 확인해보니 시간 대비 거리를 
    측정해보니 시속 60km였다. 아무래도 주간 랭킹 시스템이라는 기능과 랭킹을 통해 상품을 주
    다 보니 발생한 일인 것 같아 교통 수단을 타면 기록 측정이 안되는 기능을 추가해야했다.
### 해결 방안
  우선, 우리가 갖고 있는 기술력으로는 유저가 현재 교통 수단을 타고 있는지 알 수가 없었다.
    따라서 차선의 해결책으로 달린 시간과 거리를 통해 속도를 측정하여 일정 속도가 넘으면 교통 
    수단을 이용한 것으로 판단하기로 했다.
    단거리 러닝을 하는 사람들도 있고, 장거리 러닝을 하는 사람도 있기 때문에,  
    200m, 400m, 800m, 1.5km, 10km 등으로 거리를 나누었고, 거리 별 속도는 올림픽 육상 기준으
    로 제한하였다.
### 코드

![image](https://github.com/rmadbstjd/WeeklyRun/assets/58474431/b2abe86c-3f59-4ac3-a188-daae46a0274d)

### 효과
  주간 랭킹 시스템을 통한 공정한 경쟁이 이루어지도록함
  
### 문제 상황
 유저가 검색창에 해쉬태그를 입력할 때 해쉬태그를 끝까지 작성해야만 해쉬태그가 보이는 것은 편의성을 낮춘다고 판단함.
 따라서 해쉬태그를 끝까지 작성하지 않더라도 자동완성 기능을 통해 편의성을 높이도록 함

### 해결 방안
 1. 해쉬태그를 저장할 때 hashtags 테이블에 consonant라는 컬럼을 만들어 자음,모음으로 분리하여 저장 ex) 런닝 =>ㄹㅓㄴㄴㅣㅇ
 2. 유저가 해쉬태그를 검색창에 입력하면 korean-exrep 패키지를 사용하여 자음과 모음으로 분리함 ex) '런'을 입력하면 'ㄹㅓㄴ'으로 분리
 3. Sequelize의 OP.like 속성을 이용하여 where문을 통해 조건에 맞는 데이터를 가져온 후 리턴한다. ex) 'ㄹ'을 입력시 컬럼 consonant가 'ㄹㅓㄴ'인 데이터를 리턴
 
 ### 코드
 
![image](https://github.com/rmadbstjd/WeeklyRun/assets/58474431/685fe24c-5b9e-4367-952b-c4dc9cbe1e4d)


 ### 효과
 기존에는 검색창에 해쉬태그 '새벽런닝'을 전부 입력하였다면 개선 후에는 'ㅅ' 혹은 '새'만 쳐도 '새벽런닝'이 완성된 것을 볼 수 있음.  
 ### Before
 
 ![33](https://user-images.githubusercontent.com/58474431/194777746-669fa784-9854-4f88-9f45-5702c31f4d30.jpg)

 
 ### After
 
![11](https://user-images.githubusercontent.com/58474431/194777048-298700c2-d7e0-4dc0-91dd-6b44c507e399.jpg)
![22](https://user-images.githubusercontent.com/58474431/194777058-5d0a57a6-f851-4f1c-97f5-06094b164da2.jpg)

 
# 프로젝트에 기여한 나의 역할
 ### 게시글
- 게시글 CRUD, 최신 및 인기 순으로 게시글 정렬, 해쉬태그를 통한 게시글 검색, 좋아요 누르기, 신고하기 기능 
### 유저
- 회원가입 및 회원탈퇴, 닉네임 중복 확인, 프로필 이미지 및 닉네임 변경
### 기록
- 주간 목표 설정 및 수정, 실시간 이동한 거리 반환, 매일 달린 거리 및 시간 저장, 주간 랭킹 시스템
### 배포
- AWS EC2에 서버 배포 및 S3에 이미지 업로드 
### NodeMailer & Node-Scheduler 활용
- NodeMailer를 이용하여 유저가 회원가입시 웰컴 메일을 발송하며,
- try catch()문으로 에러를 던지면 에러의 메세지를 관리자의 계정으로 발송하여 빠르게 대처하도록 처리함.
- 유저가 게시글 신고하기 혹은 버그 리포트를 제출하면 관리자의 메일로 해당 유저의 닉네임과 신고 이유, 버그 내용 등을 발송함.
  
- Node-Scheduler를 이용하여 월요일 00시 00분에 주간 랭킹 시스템의 기록을 초기화 하고,
- 매일 달린 거리를 구분하기 위해 매일 00시 00분에 로직을 실행하여 유저가 달린 요일을 구분하여 거리 및 시간을 저장하도록 처리함.






# 팀원
|팀원 |깃허브 주소| 역할|
|-----|-----|------|
| |
|신성규 |  https://github.com/sinsk23  | 댓글, 대댓글, 로깅(winston, morgon), CICD : Jenkins|
|김대석 |  https://github.com/SkyWind4225   | 카카오로그인, 네이버로그인 |

프론트엔드 Github : https://github.com/HangHae99-Class8-FinalProject/WeeklyRun-FE

